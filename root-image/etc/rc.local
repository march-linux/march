# aspm
echo powersave > /sys/module/pcie_aspm/parameters/policy

# kernel write mode
echo 2 > /proc/sys/vm/laptop_mode
echo 90 > /proc/sys/vm/dirty_ratio
echo 1 > /proc/sys/vm/dirty_background_ratio
echo 60000 > /proc/sys/vm/dirty_expire_centisecs
echo 60000 > /proc/sys/vm/dirty_writeback_centisecs

# remount noatime
for dev in $(awk '/^\/dev\/sd/ {print $1}' /etc/mtab); do mount -o remount,noatime,commit=600 $dev; done

# Disk powersave
for dev in $(awk '/^\/dev\/sd/ {print $1}' /etc/mtab); do hdparm -S 6 -B 1 -a 2048 $dev; done
for i in /sys/class/scsi_host/host*/link_power_management_policy; do echo min_power > $i; done

# Sound card powersave
echo 1 > /sys/module/snd_hda_intel/parameters/power_save
echo Y > /sys/module/snd_hda_intel/parameters/power_save_controller
[[ -e /sys/module/snd_ac97_codec/parameters/power_save ]] && echo 1 > /sys/module/snd_ac97_codec/parameters/power_save

# Disable webcam
modprobe -r uvcvideo

# Disable bluetooth
modprobe -r btusb

# wlan0/eth0 powersave
iwconfig wlan0 power on

# Screen powersave
for i in /sys/class/backlight/acpi_video*/brightness; do echo 0 > $i; done
echo 1 > /sys/module/i915/parameters/i915_enable_rc6

# login
exec login -f march
