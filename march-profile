#!/bin/bash

MIRROR='ftp://mirrors.kernel.org/archlinux/$repo/os/$arch'
TARGET_REPOSITORIES=(core $var_MIRRORLIST extra $var_MIRRORLIST community $var_MIRRORLIST)
TARGET_PACKAGES=$(grep -v ^# /march/packages.list)

worker_intro () {
	inform "March installation may take a while. Make sure you have Internet connection."
	sleep 5
}

worker_configure_system () {
	inform "You're almost there. March will set up the system for you in seconds."
	preconfigure_target
	# copy march config
	cp /etc/sudoers $var_TARGET_DIR/etc/
	cp /etc/modprobe.d/modprobe.conf $var_TARGET_DIR/etc/modprobe.d/
	# setup rc.conf
	sed -i -e "s|^DAEMONS=.*|DAEMONS=(dbus networkmanager gdm cupsd)|" $var_TARGET_DIR/etc/rc.conf
	# remove unused app icon
	rm $var_TARGET_DIR/usr/share/applications/avahi-discover.desktop
	rm $var_TARGET_DIR/usr/share/applications/bssh.desktop
	rm $var_TARGET_DIR/usr/share/applications/bvnc.desktop
	# adduser
	chroot $var_TARGET_DIR usermod -p ZYCnDaw9NK8NI root
	chroot $var_TARGET_DIR useradd -m -p ZYCnDaw9NK8NI -g users -G audio,lp,network,optical,power,storage,video,wheel march
	postconfigure_target
}

GRUB_DEVICE=/dev/sda
PARTITIONS='/dev/sda 100:ext2:+ 512:swap *:ext4'
BLOCKDATA='/dev/sda1 raw no_label ext2;yes;/boot;target;no_opts;no_label;no_params
/dev/sda2 raw no_label swap;yes;no_mountpoint;target;no_opts;no_label;no_params
/dev/sda3 raw no_label ext4;yes;/;target;no_opts;no_label;no_params'
